<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/nolimitgpt.webflow.css" rel="stylesheet" type="text/css">
  <!-- Add the Stripe.js library -->
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="body-4">
  <!-- Navbar -->
  <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav">
    <!-- Navbar container -->
    <div class="w-container">
      <!-- Navbar logo -->
      <img src="images/magnifying_glass_logo-removebg-preview.png" loading="eager" width="100" sizes="(max-width: 479px) 42vw, 100px" srcset="images/magnifying_glass_logo-removebg-preview-p-500.png 500w, images/magnifying_glass_logo-removebg-preview.png 500w" alt="" class="image">
      <!-- Navbar brand name -->
      <a href="/" class="brand-2 w-nav-brand">nolimitGPT</a>
      <!-- Navbar navigation menu -->
      <nav role="navigation" class="navmenu w-nav-menu">
        <!-- Home page link -->
        <a href="/" class="hero-button navigationbuttonmain w-nav-link">Home</a>
      </nav>
      <!-- Navbar toggle button -->
      <div class="w-nav-button"></div>
    </div>
  </div>
  <div class="w-container"></div>
  <!-- Main content container -->
  <div class="container-3 w-container">
    <!-- User email heading -->
    <h1>Welcome, <%= user.email %></h1>
    <!-- User credits heading -->
    <h2>Your Credits: <%= user.credits %></h2>
    <!-- Check if user is subscribed -->
    <% if (!user.subscribed) { %>
      <div class="w-container">
        <div class="w-layout-grid pricing-grid">

        <!-- Trial plan pricing block -->
        <div class="pricing-block">
          <div class="pricing-top-block">
            <div class="price-title">Trial</div>
            <div class="price-number"><span class="dollar-sign">$</span>0<span class="text-span">/month</span></div>
          </div>
          <div class="pricing-bottom-block">
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">10 Credits</div>
            </div>
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">Access to all nolimitGPT tools</div>
            </div>
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">Support Email</div>
            </div>
          </div>
          <button id="subscribe-trial" type="button" class="primary-cta w-button">Start Trial</button>
        </div>
        <!-- Plan 1 pricing block -->
        <div class="pricing-block">
          <div class="pricing-top-block">
            <div class="price-title">Starter</div>
            <div class="price-number"><span class="dollar-sign">$</span>10<span class="text-span">/month</span></div>
          </div>
          <div class="pricing-bottom-block">
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">150 Credits</div>
            </div>
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">Access to all nolimitGPT tools</div>
            </div>
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">Support Email</div>
            </div>
          </div>
          <button id="subscribe-plan-1" type="button" class="primary-cta w-button">Buy Access</button>
        </div>
        <!-- Plan 2 pricing block -->
        <div class="pricing-block">
          <div class="pricing-top-block">
            <div class="price-title">Premium</div>
            <div class="price-number"><span class="dollar-sign">$</span>25<span class="text-span">/month</span></div>
          </div>
          <div class="pricing-bottom-block">
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">500 Credits</div>
            </div>
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">Access to all nolimitGPT tools</div>
            </div>
            <div class="feature-block"><img src="images/greenticksvg.png" alt="" class="tick-icon">
              <div class="feature">Support Email</div>
            </div>
          </div>
          <button id="subscribe-plan-2" type="button" class="primary-cta w-button">Buy Access</button>
        </div>
      </div>
    <% } else { %>
      
      
        <!-- Update the Cancel Subscription button with the new class -->
        <div>
        <a href="/chat" class="hero-button navigationbuttonmain w-nav-link">Chatbot</a>
  <a href="/image-generator" class="hero-button navigationbuttonmain w-nav-link">Image Generator</a>
        </div>
  <button id="cancel-subscription" type="button" class="cancel-button">Cancel Subscription</button>

      <% } %>
    
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=63c98dbc289ca6a67d09744a" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <!-- Add the JavaScript code to handle button clicks and redirect to the Checkout page -->
  <script>
// Initialize the Stripe object with the provided public key
const stripe = Stripe('pk_live_51Mg8gOE98euyK5qLDqPosFhDMIjtrVbjaWhoP73FDmP3QLUUgH9nwB3BBuKuUAXBWFr4TW7LDFdthmQug6zdNctQ008lyLlYcl');

// Add click event listener to the 'subscribe-trial' button to initiate the checkout process for the trial plan
document.getElementById('subscribe-trial')?.addEventListener('click', () => {
  createCheckoutSession('price_1MyxttE98euyK5qLy7q0aXcC'); 
});

// Add click event listener to the 'subscribe-plan-1' button to initiate the checkout process for plan 1
document.getElementById('subscribe-plan-1')?.addEventListener('click', () => {
  createCheckoutSession('price_1MyxufE98euyK5qLAy68RyR8'); 
});

// Add click event listener to the 'subscribe-plan-2' button to initiate the checkout process for plan 2
document.getElementById('subscribe-plan-2')?.addEventListener('click', () => {
  createCheckoutSession('price_1Myxv1E98euyK5qLlpy6rgv4'); 
});

// Function to create a checkout session for the provided price ID
async function createCheckoutSession(priceId) {
  try {
    // Send a POST request to the server to create the checkout session
    const response = await fetch('/create-checkout-session', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ priceId }),
    });

    if (response.ok) {
      // If the request is successful, redirect the user to the Stripe checkout page
      const session = await response.json();
      await stripe.redirectToCheckout({ sessionId: session.id });
    } else {
      console.error('Failed to create checkout session');
    }
  } catch (err) {
    console.error('Error:', err);
  }
}

// Add click event listener to the 'cancel-subscription' button to cancel the user's subscription
document.getElementById('cancel-subscription')?.addEventListener('click', async () => {
  try {
    // Send a POST request to the server to cancel the subscription
    const response = await fetch('/cancel-subscription', { method: 'POST' });

    if (response.ok) {
      // If the request is successful, show an alert and reload the page
      alert('Your subscription has been canceled');
      window.location.reload();
    } else {
      console.error('Failed to cancel subscription');
    }
  } catch (err) {
    console.error('Error:', err);
  }
});

</script>
</body>
</html>    
